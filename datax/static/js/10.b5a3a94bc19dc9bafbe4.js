webpackJsonp([10],{DtDI:function(e,o){},x7Au:function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var l=t("BO1k"),r=t.n(l),a=t("443r"),n=t("Y8t/"),s={name:"TyRoleMan",components:{deleteModal:a.a},data:function(){return{deleteShow:!1,deleteId:0,isEdit:!1,roleModalShow:!1,roleTitle:"添加角色",tbodyHeight:0,powerRoleShow:!1,roleName:"",loading:!0,formRole:{roleName:"",roleDsc:"",roleId:""},saveRoleId:"",tableData:[],menuData:[]}},mounted:function(){var e=this;this.$nextTick(function(){var o=window.screen.height-300;e.tbodyHeight=o}),this.getRoleList()},methods:{searchRole:function(){this.getRoleList()},getRoleList:function(){var e=this,o={role_name:this.roleName};n.a.getRoleList(o).then(function(o){if("200"==o.code){var t=[],l=!0,a=!1,n=void 0;try{for(var s,i=r()(o.content);!(l=(s=i.next()).done);l=!0){var c=s.value,d={roleId:c.role_id,roleName:c.role_name,roleDsc:c.role_desc};t.push(d)}}catch(e){a=!0,n=e}finally{try{!l&&i.return&&i.return()}finally{if(a)throw n}}e.tableData=t}else e.$Message.error(o.message)}).catch(function(e){})},gotoPage:function(e){},addRole:function(){var e=this,o={roleName:this.formRole.roleName,roleDesc:this.formRole.roleDsc};n.a.addRole(o).then(function(o){"200"==o.code?(e.$Message.success("添加成功"),e.roleModalShow=!1,e.getRoleList(),e.formRole.roleName="",e.formRole.roleDsc="",e.formRole.roleId=""):(e.$Message.error(o.message),e.roleCancel())}).catch(function(e){})},addClick:function(){this.roleModalShow=!0,this.isEdit=!1,this.roleTitle="添加角色",this.formRole.roleName="",this.formRole.roleDsc="",this.formRole.roleId=""},assginRole:function(e){var o=this;this.powerRoleShow=!0,this.saveRoleId=e.roleId;var t={role_id:e.roleId};n.a.getRoleMenus(t).then(function(e){if("200"==e.code){var t=[],l=!0,a=!1,n=void 0;try{for(var s,i=r()(e.content);!(l=(s=i.next()).done);l=!0){var c=s.value,d={title:c.menu_name,expand:!0,selected:!1,checked:c.is_checked,is_leaf_menu:c.is_leaf_menu,menu_deep:c.menu_deep,menu_id:c.menu_id,menu_url:c.menu_url,order_no:c.order_no,parent_id:c.parent_id,children:o.returnChild(c)};t.push(d)}}catch(e){a=!0,n=e}finally{try{!l&&i.return&&i.return()}finally{if(a)throw n}}o.menuData=t}else o.$Message.error(e.message),o.roleCancel()}).catch(function(e){})},returnChild:function(e){var o=[];if(null!=e.childMenu){var t=!0,l=!1,a=void 0;try{for(var n,s=r()(e.childMenu);!(t=(n=s.next()).done);t=!0){var i=n.value,c={title:i.menu_name,expand:!0,selected:!1,checked:i.is_checked,is_leaf_menu:i.is_leaf_menu,menu_deep:i.menu_deep,menu_id:i.menu_id,menu_url:i.menu_url,order_no:i.order_no,parent_id:i.parent_id,children:this.returnChild(i)};o.push(c)}}catch(e){l=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(l)throw a}}}return o},powerRoleOk:function(){var e=this,o=this.$refs.tree.getCheckedNodes(),t="",l=!0,a=!1,s=void 0;try{for(var i,c=r()(o);!(l=(i=c.next()).done);l=!0){t+=i.value.menu_id+","}}catch(e){a=!0,s=e}finally{try{!l&&c.return&&c.return()}finally{if(a)throw s}}var d={roleId:this.saveRoleId,menuIds:t.substring(0,t.length-1)};n.a.confRoleMenu(d).then(function(o){e.$Message.success("权限分配成功"),"200"==o.code?setTimeout(function(){e.powerRoleShow=!1,e.saveRoleId=""},1e3):e.$Message.error(o.message)}).catch(function(e){})},powerRoleCancel:function(){this.powerRoleShow=!1},editClick:function(e){this.roleModalShow=!0,this.isEdit=!0,this.roleTitle="修改角色",this.formRole.roleName=e.roleName,this.formRole.roleDsc=e.roleDsc,this.formRole.roleId=e.roleId},deleteBtn:function(e){this.deleteShow=!0},roleOk:function(){this.isEdit?this.updateRole():this.addRole()},updateRole:function(){var e=this,o={roleName:this.formRole.roleName,roleDesc:this.formRole.roleDsc,roleId:this.formRole.roleId};n.a.updateRole(o).then(function(o){"200"==o.code?(e.$Message.success("修改成功"),e.roleModalShow=!1,e.formRole.roleName="",e.formRole.roleDsc="",e.formRole.roleId="",e.getRoleList()):(e.$Message.error(o.message),e.roleCancel())}).catch(function(e){})},roleCancel:function(){this.isEdit=!1,this.roleTitle="添加角色"},sureDelete:function(e){this.deleteShow=e.isShow},changeShowDel:function(e){this.deleteShow=e}}},i={render:function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("div",{staticClass:"ty_topInput"},[t("span",[t("span",{staticClass:"ty_serachSapn"},[e._v("角色名称：")]),e._v(" "),t("Input",{staticStyle:{width:"150px"},attrs:{placeholder:"角色名称"},model:{value:e.roleName,callback:function(o){e.roleName=o},expression:"roleName"}})],1),e._v(" "),t("span",[t("Button",{attrs:{type:"primary",icon:"search"},on:{click:e.searchRole}},[e._v("搜索")])],1),e._v(" "),t("span",{staticClass:"fr ty_searchLastSpan"},[t("Button",{attrs:{type:"primary",icon:"android-add"},on:{click:e.addClick}},[e._v("添加角色")])],1)]),e._v(" "),t("div",{staticClass:"ty_tableShowDiv"},[t("div",{staticClass:"ty_table"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:e.tbodyHeight,border:""}},[t("el-table-column",{attrs:{prop:"roleName",label:"角色名称"}}),e._v(" "),t("el-table-column",{attrs:{prop:"roleDsc",label:"角色描述"}}),e._v(" "),t("el-table-column",{attrs:{prop:"controler",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.assginRole(o.row)}}},[e._v("分配权限")]),e._v(" "),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.editClick(o.row)}}},[e._v("编辑")])]}}])})],1)],1)]),e._v(" "),t("delete-modal",{attrs:{deleteId:e.deleteId,deleteShow:e.deleteShow},on:{deleteSure:e.sureDelete,changeShow:e.changeShowDel}}),e._v(" "),t("Modal",{attrs:{title:e.roleTitle,closable:!1,"class-name":"vertical-center-modal"},on:{"on-ok":e.roleOk,"on-cancel":e.roleCancel},model:{value:e.roleModalShow,callback:function(o){e.roleModalShow=o},expression:"roleModalShow"}},[t("Form",{ref:"formRole",attrs:{model:e.formRole,"label-width":80}},[t("FormItem",{attrs:{label:"角色名称:",prop:"roleName"}},[t("Input",{staticClass:"ty_userInput",model:{value:e.formRole.roleName,callback:function(o){e.$set(e.formRole,"roleName",o)},expression:"formRole.roleName"}})],1),e._v(" "),t("FormItem",{attrs:{label:"描述:",prop:"roleDsc"}},[t("Input",{staticClass:"ty_userInput ty_inputText",attrs:{type:"textarea"},model:{value:e.formRole.roleDsc,callback:function(o){e.$set(e.formRole,"roleDsc",o)},expression:"formRole.roleDsc"}})],1)],1)],1),e._v(" "),t("Modal",{attrs:{closable:!1,title:"分配权限",loading:e.loading,"class-name":"vertical-center-modal"},on:{"on-ok":e.powerRoleOk,"on-cancel":e.powerRoleCancel},model:{value:e.powerRoleShow,callback:function(o){e.powerRoleShow=o},expression:"powerRoleShow"}},[t("div",{staticClass:"roleContain"},[t("Tree",{ref:"tree",staticClass:"powerTreeDiv",attrs:{"show-checkbox":"",multiple:"",data:e.menuData}})],1)])],1)},staticRenderFns:[]};var c=t("VU/8")(s,i,!1,function(e){t("DtDI")},"data-v-0e2ff28f",null);o.default=c.exports}});